trigger:
- main

pool:
  name: LocalWindows  # your self-hosted agent name

variables:
  SONARQUBE_PROJECT_KEY: 'devops-pipeline-demo'
  SONARQUBE_PROJECT_NAME: 'devops-pipeline-demo'
  SONARQUBE_HOST_URL: 'http://localhost:9000'

steps:
- checkout: self

- task: Gradle@2
  displayName: 'Gradle Build and SonarQube Analysis'
  inputs:
    gradleWrapperFile: 'src/gradlew.bat'
    workingDirectory: 'src'
    tasks: 'sonarqube build'
    options: >
      --warning-mode all
      -Dsonar.projectKey=$(SONARQUBE_PROJECT_KEY)
      -Dsonar.projectName=$(SONARQUBE_PROJECT_NAME)
      -Dsonar.host.url=$(SONARQUBE_HOST_URL)
      -Dsonar.login=$(SONARQUBE_TOKEN)

